<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NovaMarket | Tienda Online</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        <div style="display:flex; align-items:center; gap:15px;">
            <h1>ğŸ›’ NovaMarket</h1>
            <button onclick="toggleDarkMode()" class="btn-icon">ğŸŒ™</button>
        </div>
        
        <div style="display: flex; gap: 10px; align-items: center;">
            <div id="user-info" style="display:none; color:white; font-size:0.9rem; text-align:right;">
                Hola, <span id="user-name" style="font-weight:bold;">Usuario</span><br>
                <small id="user-role" style="opacity:0.8">Cliente</small>
            </div>
            <button class="btn-accent" onclick="abrirCarrito()">
                ğŸ›ï¸ <span id="badge-count" class="badge">0</span>
            </button>
            <button id="btn-login-main" class="btn-primary" onclick="toggleLogin()">Ingresar</button>
            <button id="btn-logout-main" class="btn-danger" style="display:none;" onclick="logout()">Salir</button>
        </div>
    </header>

    <div id="admin-bar" class="admin-bar">
        <div style="display:flex; align-items:center; gap:10px;">
            <span style="font-weight:bold;">ğŸ” GERENCIA</span>
            <span class="stat-badge">Ventas Hoy: <span id="admin-ventas-hoy">$0.00</span></span>
        </div>
        <div>
            <button class="btn-info" onclick="abrirDashboard()">ğŸ“Š Panel Control</button>
            <button class="btn-success" onclick="abrirModalProducto()">+ Producto</button>
        </div>
    </div>

    <div class="container">
        <div class="controls-panel">
            <input type="text" id="buscador" placeholder="ğŸ” Buscar productos..." onkeyup="filtrarProductos()">
            <div id="filtros-categorias" class="cat-filters"></div>
        </div>
        <h2>Nuestros Productos</h2>
        <div id="grid-productos" class="grid"></div>
    </div>

    <div id="modal-carrito" class="modal">
        <div class="modal-content">
            <h2>Tu Carrito ğŸ›’</h2>
            <div id="lista-carrito" class="cart-list"></div>
            <div class="cart-summary"><p>Total: <strong style="font-size:1.4rem">$<span id="total-carrito">0.00</span></strong></p></div>
            <button class="btn-success full-width" onclick="iniciarCheckout()">Pagar</button>
            <button class="btn-secondary full-width" onclick="cerrarModal('modal-carrito')">Cerrar</button>
        </div>
    </div>

    <div id="modal-checkout" class="modal">
        <div class="modal-content checkout-content">
            <h2>Finalizar Compra</h2>
            <div id="checkout-form-view">
                <p>MÃ©todo de pago:</p>
                <div class="payment-options">
                    <label class="payment-card" onclick="setMetodo('tarjeta')">
                        <input type="radio" name="pago" value="tarjeta" checked> <span>ğŸ’³ Tarjeta</span>
                    </label>
                    <label class="payment-card" onclick="setMetodo('caja')">
                        <input type="radio" name="pago" value="caja"> <span>ğŸ’µ Efectivo</span>
                    </label>
                </div>
                <div id="form-tarjeta" class="fake-form">
                    <input type="text" placeholder="0000 0000 0000 0000">
                    <div style="display:flex; gap:10px;"><input type="text" placeholder="MM/AA"><input type="text" placeholder="CVV"></div>
                </div>
                <div id="info-caja" class="fake-form" style="display:none; padding:15px; background:rgba(0,0,0,0.05);">
                    <p>ğŸ“¦ Paga al recoger en caja.</p>
                </div>
                <button class="btn-success full-width" onclick="procesarPago()">Confirmar</button>
                <button class="btn-secondary full-width" onclick="cerrarModal('modal-checkout')">Cancelar</button>
            </div>
            <div id="checkout-loading" style="display:none; text-align:center; padding:30px;">
                <div class="spinner"></div><h3>Procesando...</h3>
            </div>
        </div>
    </div>

    <div id="modal-dashboard" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="tabs">
                <button class="tab-link active" onclick="verTab('resumen')">ğŸ“Š Resumen</button>
                <button class="tab-link" onclick="verTab('clientes')">ğŸ‘¥ Clientes</button>
                <button class="tab-link" onclick="verTab('config')">âš™ï¸ Config</button>
            </div>

            <div id="tab-resumen" class="tab-content active">
                <div class="stats-grid">
                    <div class="stat-card"><h4>Ventas Hoy</h4><p class="stat-num c-green" id="dash-corte">$0</p></div>
                    <div class="stat-card"><h4>Total HistÃ³rico</h4><p class="stat-num c-blue" id="dash-ingresos">$0</p></div>
                    <div class="stat-card"><h4>Stock CrÃ­tico</h4><p class="stat-num c-red" id="dash-stock">0</p></div>
                </div>
                <div class="chart-wrapper"><canvas id="ventasChart"></canvas></div>
                <button class="btn-primary full-width" onclick="hacerCorteCaja()">âœ‚ï¸ CORTE DE CAJA</button>
            </div>

            <div id="tab-clientes" class="tab-content">
                <h2>Cartera de Clientes</h2>
                <table class="data-table">
                    <thead><tr><th>Nombre</th><th>Email</th><th>Acciones</th></tr></thead>
                    <tbody id="lista-clientes-admin"></tbody>
                </table>
            </div>

            <div id="tab-config" class="tab-content">
                <h3>Seguridad</h3>
                <input type="password" id="new-admin-pass" placeholder="Nueva clave de Gerente">
                <button class="btn-success full-width" onclick="cambiarPasswordAdmin()">Actualizar ContraseÃ±a</button>
            </div>
            <button class="btn-secondary full-width" onclick="cerrarModal('modal-dashboard')">Cerrar</button>
        </div>
    </div>

    <div id="modal-historial" class="modal">
        <div class="modal-content">
            <h3>Historial de Compras</h3>
            <p>Cliente: <span id="historial-cliente-email" style="font-weight:bold;"></span></p>
            <div id="lista-historial" style="max-height:300px; overflow-y:auto; margin-top:10px; border:1px solid #eee;">
                </div>
            <button class="btn-secondary full-width" onclick="cerrarModal('modal-historial')">Cerrar</button>
        </div>
    </div>

    <div id="modal-login" class="modal">
        <div class="modal-content narrow">
            <div id="form-login">
                <h3>Iniciar SesiÃ³n</h3>
                <p id="msg-error" class="error-msg">Datos incorrectos</p>
                <input type="email" id="login-email" placeholder="Email">
                <input type="password" id="login-pass" placeholder="ContraseÃ±a">
                <button class="btn-primary full-width" onclick="login()">Entrar</button>
                <p style="text-align:center; font-size:0.9rem; margin-top:10px;">
                    Â¿No tienes cuenta? <a href="#" onclick="toggleRegistro()">RegÃ­strate aquÃ­</a>
                </p>
                <button class="btn-secondary full-width" onclick="cerrarModal('modal-login')">Cancelar</button>
            </div>
            <div id="form-registro" style="display:none;">
                <h3>Crear Cuenta</h3>
                <input type="text" id="reg-nombre" placeholder="Nombre completo">
                <input type="email" id="reg-email" placeholder="Correo electrÃ³nico">
                <input type="password" id="reg-pass" placeholder="ContraseÃ±a">
                <button class="btn-success full-width" onclick="registrarCliente()">Registrarme</button>
                <p style="text-align:center; font-size:0.9rem; margin-top:10px;">
                    <a href="#" onclick="toggleRegistro()">Volver al Login</a>
                </p>
            </div>
        </div>
    </div>

    <div id="modal-producto" class="modal">
        <div class="modal-content">
            <h3 id="titulo-modal-prod">Producto</h3>
            <input type="hidden" id="prod-id">
            <input type="text" id="prod-nombre" placeholder="Nombre">
            <div style="display:flex; gap:10px;"><input type="number" id="prod-precio" placeholder="Precio"><input type="number" id="prod-stock" placeholder="Stock"></div>
            <input type="text" id="prod-cat" placeholder="CategorÃ­a">
            <input type="text" id="prod-img" placeholder="URL Imagen">
            <button class="btn-success full-width" onclick="guardarProducto()">Guardar</button>
            <button class="btn-secondary full-width" onclick="cerrarModal('modal-producto')">Cancelar</button>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>